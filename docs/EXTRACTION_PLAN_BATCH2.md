# Extraction Plan - Batch 2

97 documents, 8,784 pages total. Organized by size for Option A approach.

## Processing Estimate

| Batch | Documents | Pages | Est. Time |
|-------|-----------|-------|-----------|
| Small (<30 pages) | 44 | 616 | ~18 hours |
| Medium (30-100 pages) | 31 | 1,544 | ~46 hours |
| Large (100+ pages) | 22 | 6,624 | ~197 hours |
| **Total** | **97** | **8,784** | **~261 hours** |

---

## Batch 1: Small Documents (<30 pages)

44 documents, 616 pages, ~18 hours

| Pages | Slug | PDF File |
|-------|------|----------|
| 2 | `usgs_projections_poster` | projectionsPoster_USGS.pdf |
| 3 | `cdfw_projections` | CDFW_Projection_and_Datum_Guidelines.pdf |
| 4 | `imeo_brochure_2022` | climateGHG_IMEO-brochure_2022.pdf |
| 6 | `graph_databases_overview` | Graph_databases_overview_CS2311924.pdf |
| 6 | `eu_kndvi_time` | timeEU_kNdvi.pdf |
| 7 | `ghg_usa_points_2022` | satGHG_USA_pts_2022.pdf |
| 7 | `sentinel2a_save_2024` | save_S2A_2024.pdf |
| 7 | `proj_gdal_survey` | survey_ProjGDAL.pdf |
| 8 | `jaxa_dashboard` | cloudJAXA_dashboard.pdf |
| 8 | `eu_eo_overview` | dataEO_EU_ovr.pdf |
| 8 | `gnss_mgpp_2023` | gnss_MGPP_2023.pdf |
| 8 | `green_marble_2022` | greenMarble_product_2022.pdf |
| 10 | `ghg_gulf_usa_2022` | satGHG_gulf_USA_2022.pdf |
| 10 | `methane_harvard_2023` | satMethane_harvardBall_2023.pdf |
| 12 | `gist_trees_1995` | hellerstein-etal-1995.pdf |
| 12 | `amoc_atlantic_2024` | oceanAtlantic_article_AMOC_2024.pdf |
| 12 | `mapreduce_dean_1995` | sfwr_Dean_1995.pdf |
| 14 | `ecobird_2022` | ecoBird_2022.pdf |
| 14 | `nasa_csda_roses_2021` | NASA_CSDA_ROSES_data_2021.pdf |
| 15 | `earthdaily_2023` | EarthDaily_Keith-Beckett_May_17.pdf |
| 16 | `lulc_esa_usgs_2021` | lulcComp_esa_usgsPT_2021.pdf |
| 16 | `urban_osm_ml_2018` | urbanML_OSM_forget_2018.pdf |
| 17 | `osm_history_2019` | osmHist_Minghini_2019.pdf |
| 17 | `nasa_cms_ghg_2021` | satGHG_NASA_CMS_2021.pdf |
| 18 | `rs_deep_learning_2021` | remotesensing-13-04622.pdf |
| 19 | `coast_mapping_2021` | coastMapping_robby_2021.pdf |
| 19 | `sentinel2_coverage_2019` | esaSent2_coverages_2019.pdf |
| 19 | `geoss_2030_agenda` | GEOSS_2030_agenda.pdf |
| 20 | `sql_trees_celko` | Joe_Celco_Trees_in_SQL.pdf |
| 20 | `rs_land_cover_ml_2021` | remotesensing-13-02428.pdf |
| 21 | `openeo_architecture_2021` | openEO_arch_2021.pdf |
| 21 | `rs_sentinel2_cloud_2021` | remotesensing-13-01125-v3.pdf |
| 21 | `rs_change_detection_2021` | remotesensing-13-04807-v2.pdf |
| 23 | `planet_arp_2024` | Planet_AnalysisReadyPlanetScopev1_2024.pdf |
| 24 | `gedi_l2_2020` | ornl_GEDI2_2020.pdf |
| 24 | `methane_overview_2022` | satMethane_ovr_2022.pdf |
| 25 | `carbon_mapper_2024` | CarbonMapper_data_v114.pdf |
| 25 | `usfs_wildfire_crisis_2022` | Confronting-Wildfire-Crisis_USFS_2022.pdf |
| 25 | `methane_rmi_2023` | satMethane_RMI_2023.pdf |
| 27 | `noaa_ccap_ca_2023` | dataAccess_NOAA_ccap_CA_2023.pdf |
| 27 | `esa_lsi_vc_2025` | esa_LSI-VC_interop_2025.pdf |
| 28 | `tropomi_nl_2023` | satTROPOMI_nl_2023.pdf |
| 29 | `land_cover_kotsev_2019` | landcover_Kotsev_2019.pdf |
| 29 | `lclas_us_2023` | satLCLAS_usob_2023.pdf |

---

## Batch 2: Medium Documents (30-100 pages)

31 documents, 1,544 pages, ~46 hours

| Pages | Slug | PDF File |
|-------|------|----------|
| 30 | `copernicus_report_20` | analytical-report_20_copernicus.pdf |
| 30 | `methane_egu_2022` | satMethane_egu_2022.pdf |
| 33 | `landsat_50years_2021` | landsat50_remotesensing_2021.pdf |
| 34 | `sentinel2_mpc_gri_v2` | S2-MPC_PHB_MultiLayer_L1B_GRI_V2.pdf |
| 35 | `geoawesome_geoforgood_2025` | Geoawesome_GeoForGood_2025.pdf |
| 35 | `random_forests_review` | randomforests-rev.pdf |
| 35 | `sat_lao_us_2024` | satLAO_us_2024.pdf |
| 36 | `copernicus_dem_v4_2022` | demCopernicus_Handbook_v4_2022.pdf |
| 36 | `jacie_overview_2024` | satJACIE_ovr_2024.pdf |
| 38 | `ghg_geo_2021` | climateGHG_GEO_2021.pdf |
| 40 | `methane_egusphere_2023` | satMethane_egusphere_2023.pdf |
| 41 | `india_space_2025` | satIndia_SpaceEconomyRegulatoryHandbook_2025.pdf |
| 47 | `tropomi_nl_2022` | satTROPOMI_nl_2022.pdf |
| 53 | `calfire_redbook_2020` | CalFIRE_Redbook_2020.pdf |
| 56 | `carto_geodatascience_2024` | carto_geoDataScience_2024.pdf |
| 59 | `open_geodata_2023` | OpenGeodata_Ochwada_2023.pdf |
| 68 | `sentinel2_mpc_gcp_v3` | S2-MPC_PHB_GCP_L1B_L1C_GRI_V3.pdf |
| 74 | `foss4g_na_2018_sql` | FOSS4G_NA_2018_SQLFest.pdf |
| 78 | `copernicus_cristal_mrd` | Copernicus_CRISTAL_MRD_v3_2020.pdf |
| 80 | `eu_jrc_data_2023` | dataEU_JRC129900_2023.pdf |
| 81 | `geoland_handbook` | GEOLAND-Handbook-EN.pdf |
| 84 | `copernicus_co2m_mrd` | Copernicus_CO2M_MRD_v3_2020.pdf |
| 90 | `copernicus_rosel_mrd` | Copernicus_ROSE-L_MRD_v2.pdf |
| 91 | `esa_cci_hrlc_field_2023` | esa_CCI_HRLCv4_field_2023.pdf |
| 97 | `copernicus_chime_mrd` | Copernicus_CHIME_MRD_v3_2021.pdf |

---

## Batch 3: Large Documents (100+ pages)

22 documents, 6,624 pages, ~197 hours

| Pages | Slug | PDF File |
|-------|------|----------|
| 112 | `unep_egr_2021` | unep_EGR_2021.pdf |
| 114 | `landsat8_manual_v5` | landsat8_datamanual_v5.pdf |
| 115 | `esa_cci_hrlc_val2_2023` | esa_CCI_HRLCv4_val2_2023.pdf |
| 115 | `landsat9_manual` | landsat9_datamanual.pdf |
| 116 | `sentinel_access_2018` | COPE_Sentinel_Data_Access_Annual_2018.pdf |
| 126 | `sentinel_access_2020` | COPE-SERCO-RP-21-1141_Sentinel_Data_Access_Annual_2020_v2.3.pdf |
| 128 | `sentinel_access_2021` | COPE-SERCO-RP-22-1312_Sentinel_Data_Access_Annual_2021.pdf |
| 134 | `sentinel_access_2019` | COPE-SERCO-RP-20-0570_Sentinel_Data_Access_Annual_2019.pdf |
| 135 | `esa_cci_hrlc_val1_2023` | esa_CCI_HRLCv4_val1_2023.pdf |
| 136 | `imeo_report_2022` | climateGHG_IMEO_2022.pdf |
| 139 | `nisar_spec_2019` | NASA_ISRO_NISAR_spec_2019.pdf |
| 140 | `gst_catalog_2022` | satSO_GST-catalog_2022.pdf |
| 142 | `esa_data_access_2024` | esa_dataAccess_2024.pdf |
| 142 | `unep_methane_2023` | unep_eye-on-methane_2023.pdf |
| 143 | `geo_fullpic_2020` | GEO_fullPic_2020.pdf |
| 191 | `foss4g_2017` | FOSS4G_2017_Full_Proceedings.pdf |
| 196 | `nas_ghg_2022` | climateGHG_NAS_2022.pdf |
| 248 | `wildfire_california_2020` | Wildfire-in-California_ccst_2020.pdf |
| 250 | `gnss_overview_2022` | gnss_ovr_2022.pdf |
| 260 | `gfoi_mgd_2016` | forestAU_GFOI-MGD_2016.pdf |
| 262 | `gnss_overview_2023` | gnss_ovr_2023.pdf |
| 267 | `water_worldbank_2016` | water_WorldBank_2016.pdf |
| 269 | `copernicus_cimr_mrd` | Copernicus_CIMR_MRD_v5_2023.pdf |
| 298 | `jacie_2022` | satJACIE_2022.pdf |
| 437 | `foss4g_2015` | FOSS4G_2015_Proceedings_v2.pdf |
| 455 | `geomatics_book_2019` | geombook2019.01.11.pdf |
| 665 | `ca_climate_2022` | ca_ClimateIndicators-4th_OEHH_2022.pdf |
| 965 | `proj_manual_96` | proj-org-en-9.6.pdf |

---

## Pipeline Overview

From docs/EXTRACTION.md and docs/ARCHITECTURE.md:

```
PDF --> Vision LLM (8090) --> Elements + bboxes --> Enrichment LLM (8080) --> search_text
                                                                    |
                                                                    v
                                                          BGE-M3 (8094) --> PostgreSQL
```

**Three stages:**
1. **Extract**: Vision model detects elements with bounding boxes (~107s/page avg)
2. **Enrich**: Text model generates search_text + page/doc summaries (~2.5s/element)
3. **Ingest**: Embeddings + database insertion (~2 min/doc)

---

## GPU Memory Constraint

**IMPORTANT**: The Vision LLM (Qwen3-VL-235B, ~51GB VRAM) and Text LLM (Qwen3-30B) 
cannot run simultaneously - GPU will fail. Must run sequentially:

```
Phase 1: EXTRACT all documents    (Vision LLM running, Text LLM off)
Phase 2: ENRICH + INGEST all      (Vision LLM off, Text LLM + Embedding running)
```

The BGE-M3 embedding server (8094) is small enough to run alongside either.

**Recommended workflow:**
1. Start Vision LLM, extract ALL documents in a batch
2. Stop Vision LLM, start Text LLM
3. Enrich and ingest ALL extracted documents

---

## Extraction Commands

### Pre-flight Check

```bash
cd ~/github/osgeo-library
source .venv/bin/activate

# For EXTRACTION phase:
curl -s http://localhost:8090/health && echo " - Vision (8090) OK" || echo " - Vision FAILED"

# For ENRICHMENT phase:
curl -s http://localhost:8080/health && echo " - Text (8080) OK" || echo " - Text FAILED"  
curl -s http://localhost:8094/health && echo " - Embedding (8094) OK" || echo " - Embedding FAILED"

# Database (always needed for ingest)
psql -d osgeo_library -c "SELECT COUNT(*) FROM documents;"
```

### Start Servers

```bash
# On minto - GPU servers (run ONE large model at a time!)

# Phase 1: Extraction
/media/nvme2g-a/llm_toolbox/servers/qwen3-vl-235b-8090.sh &  # Vision (51GB VRAM)

# Phase 2: Enrichment + Ingestion (stop vision first!)
pkill -f "qwen3-vl-235b"  # Stop vision model
/media/nvme2g-a/llm_toolbox/servers/qwen3-30b-32k.sh &       # Text/enrichment
/media/nvme2g-a/llm_toolbox/servers/bge-m3-embed-8094.sh &   # Embeddings (small, can coexist)
```

### Single Document - Full Pipeline

```bash
# Step 1: Extract all pages (uses archived script with full functionality)
python archive/2025-12-29/extract_all_pages.py pdfs/batch2/FILE.pdf \
  --name SLUG --skip-existing --delay 2

# Step 2: Enrich (elements + page summaries + doc summary)
doclibrary enrich SLUG --skip-existing

# Step 3: Ingest to database
doclibrary ingest SLUG --delete-first
```

### Batch Processing Script

Use `scripts/run_batch2.sh` for automated batch processing:

```bash
# Process all small documents
./scripts/run_batch2.sh small

# Process specific document
./scripts/run_batch2.sh single proj_gdal_survey

# Resume from interruption (skips completed)
./scripts/run_batch2.sh small --resume

# Check status
./scripts/run_batch2.sh status
```

---

## Progress Tracking

### Batch 1: Small (<30 pages) - 44 docs

- [ ] usgs_projections_poster (2)
- [ ] cdfw_projections (3)
- [ ] imeo_brochure_2022 (4)
- [ ] graph_databases_overview (6)
- [ ] eu_kndvi_time (6)
- [ ] ghg_usa_points_2022 (7)
- [ ] sentinel2a_save_2024 (7)
- [ ] proj_gdal_survey (7)
- [ ] jaxa_dashboard (8)
- [ ] eu_eo_overview (8)
- [ ] gnss_mgpp_2023 (8)
- [ ] green_marble_2022 (8)
- [ ] ghg_gulf_usa_2022 (10)
- [ ] methane_harvard_2023 (10)
- [ ] gist_trees_1995 (12)
- [ ] amoc_atlantic_2024 (12)
- [ ] mapreduce_dean_1995 (12)
- [ ] ecobird_2022 (14)
- [ ] nasa_csda_roses_2021 (14)
- [ ] earthdaily_2023 (15)
- [ ] lulc_esa_usgs_2021 (16)
- [ ] urban_osm_ml_2018 (16)
- [ ] osm_history_2019 (17)
- [ ] nasa_cms_ghg_2021 (17)
- [ ] rs_deep_learning_2021 (18)
- [ ] coast_mapping_2021 (19)
- [ ] sentinel2_coverage_2019 (19)
- [ ] geoss_2030_agenda (19)
- [ ] sql_trees_celko (20)
- [ ] rs_land_cover_ml_2021 (20)
- [ ] openeo_architecture_2021 (21)
- [ ] rs_sentinel2_cloud_2021 (21)
- [ ] rs_change_detection_2021 (21)
- [ ] planet_arp_2024 (23)
- [ ] gedi_l2_2020 (24)
- [ ] methane_overview_2022 (24)
- [ ] carbon_mapper_2024 (25)
- [ ] usfs_wildfire_crisis_2022 (25)
- [ ] methane_rmi_2023 (25)
- [ ] noaa_ccap_ca_2023 (27)
- [ ] esa_lsi_vc_2025 (27)
- [ ] tropomi_nl_2023 (28)
- [ ] land_cover_kotsev_2019 (29)
- [ ] lclas_us_2023 (29)

### Batch 2: Medium (30-100 pages) - 31 docs

- [ ] copernicus_report_20 (30)
- [ ] methane_egu_2022 (30)
- [ ] landsat_50years_2021 (33)
- [ ] sentinel2_mpc_gri_v2 (34)
- [ ] geoawesome_geoforgood_2025 (35)
- [ ] random_forests_review (35)
- [ ] sat_lao_us_2024 (35)
- [ ] copernicus_dem_v4_2022 (36)
- [ ] jacie_overview_2024 (36)
- [ ] ghg_geo_2021 (38)
- [ ] methane_egusphere_2023 (40)
- [ ] india_space_2025 (41)
- [ ] tropomi_nl_2022 (47)
- [ ] calfire_redbook_2020 (53)
- [ ] carto_geodatascience_2024 (56)
- [ ] open_geodata_2023 (59)
- [ ] sentinel2_mpc_gcp_v3 (68)
- [ ] foss4g_na_2018_sql (74)
- [ ] copernicus_cristal_mrd (78)
- [ ] eu_jrc_data_2023 (80)
- [ ] geoland_handbook (81)
- [ ] copernicus_co2m_mrd (84)
- [ ] copernicus_rosel_mrd (90)
- [ ] esa_cci_hrlc_field_2023 (91)
- [ ] copernicus_chime_mrd (97)

### Batch 3: Large (100+ pages) - 22 docs

- [ ] unep_egr_2021 (112)
- [ ] landsat8_manual_v5 (114)
- [ ] esa_cci_hrlc_val2_2023 (115)
- [ ] landsat9_manual (115)
- [ ] sentinel_access_2018 (116)
- [ ] sentinel_access_2020 (126)
- [ ] sentinel_access_2021 (128)
- [ ] sentinel_access_2019 (134)
- [ ] esa_cci_hrlc_val1_2023 (135)
- [ ] imeo_report_2022 (136)
- [ ] nisar_spec_2019 (139)
- [ ] gst_catalog_2022 (140)
- [ ] esa_data_access_2024 (142)
- [ ] unep_methane_2023 (142)
- [ ] geo_fullpic_2020 (143)
- [ ] foss4g_2017 (191)
- [ ] nas_ghg_2022 (196)
- [ ] wildfire_california_2020 (248)
- [ ] gnss_overview_2022 (250)
- [ ] gfoi_mgd_2016 (260)
- [ ] gnss_overview_2023 (262)
- [ ] water_worldbank_2016 (267)
- [ ] copernicus_cimr_mrd (269)
- [ ] jacie_2022 (298)
- [ ] foss4g_2015 (437)
- [ ] geomatics_book_2019 (455)
- [ ] ca_climate_2022 (665)
- [ ] proj_manual_96 (965)

---

## Notes

- Slugs follow pattern: `topic_subtopic_year` or `source_topic_year`
- All slugs are lowercase with underscores
- Conference proceedings use `foss4g_YEAR` format
- Copernicus MRDs use `copernicus_MISSION_mrd` format
- Remote sensing papers use `rs_topic_year` format
