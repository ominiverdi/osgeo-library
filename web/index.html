<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Extraction Comparison - OSGeo Library</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            color: #333;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .controls select, .controls button {
            padding: 10px 15px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
        }
        .controls button {
            background: #3498db;
            color: white;
            border: none;
            cursor: pointer;
        }
        .controls button:hover {
            background: #2980b9;
        }
        .comparison-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            max-width: 1800px;
            margin: 0 auto;
        }
        .panel {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .panel-header {
            background: #2c3e50;
            color: white;
            padding: 15px;
            font-weight: bold;
        }
        .panel-header.traditional {
            background: #e74c3c;
        }
        .panel-header.multimodal {
            background: #27ae60;
        }
        .panel-header.original {
            background: #3498db;
        }
        .panel-content {
            padding: 15px;
            max-height: 800px;
            overflow-y: auto;
        }
        .page-image {
            width: 100%;
            height: auto;
            border: 1px solid #eee;
        }
        .extraction-text {
            white-space: pre-wrap;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            line-height: 1.5;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
        }
        .section {
            margin-bottom: 15px;
        }
        .section-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }
        .figure-item {
            background: #e8f4fd;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .figure-item .caption {
            font-weight: bold;
            color: #2980b9;
        }
        .figure-item .description {
            margin-top: 5px;
            font-style: italic;
            color: #555;
        }
        .key-concepts {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        .concept-tag {
            background: #9b59b6;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 11px;
        }
        .citation-tag {
            background: #f39c12;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 11px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        .stat-box {
            background: #f8f9fa;
            padding: 10px;
            text-align: center;
            border-radius: 4px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        .stat-label {
            font-size: 11px;
            color: #666;
        }
        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }
        .no-data {
            text-align: center;
            padding: 30px;
            color: #999;
            font-style: italic;
        }
        @media (max-width: 1200px) {
            .comparison-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <h1>PDF Extraction Comparison</h1>
    <p class="subtitle">Compare Traditional vs Multimodal extraction methods for scientific papers</p>
    
    <div class="controls">
        <select id="pdf-select">
            <option value="">-- Select PDF --</option>
        </select>
        <select id="page-select">
            <option value="">-- Select Page --</option>
        </select>
        <button onclick="prevPage()">Previous</button>
        <button onclick="nextPage()">Next</button>
    </div>
    
    <div class="comparison-container">
        <!-- Original PDF Page -->
        <div class="panel">
            <div class="panel-header original">Original PDF Page</div>
            <div class="panel-content" id="original-panel">
                <div class="no-data">Select a PDF and page to view</div>
            </div>
        </div>
        
        <!-- Traditional Extraction -->
        <div class="panel">
            <div class="panel-header traditional">Traditional (PyMuPDF)</div>
            <div class="panel-content" id="traditional-panel">
                <div class="no-data">Select a PDF and page to view</div>
            </div>
        </div>
        
        <!-- Multimodal Extraction -->
        <div class="panel">
            <div class="panel-header multimodal">Multimodal (Gemini)</div>
            <div class="panel-content" id="multimodal-panel">
                <div class="no-data">Select a PDF and page to view</div>
            </div>
        </div>
    </div>
    
    <script>
        let comparisonData = null;
        let currentPdf = null;
        let currentPage = 1;
        
        async function loadData() {
            try {
                const response = await fetch('data/comparisons.json');
                comparisonData = await response.json();
                populatePdfSelect();
            } catch (e) {
                console.error('Failed to load comparison data:', e);
                document.getElementById('original-panel').innerHTML = 
                    '<div class="no-data">Error loading data. Make sure comparisons.json exists.</div>';
            }
        }
        
        function populatePdfSelect() {
            const select = document.getElementById('pdf-select');
            select.innerHTML = '<option value="">-- Select PDF --</option>';
            
            for (const pdfName in comparisonData.pdfs) {
                const option = document.createElement('option');
                option.value = pdfName;
                option.textContent = pdfName;
                select.appendChild(option);
            }
            
            select.addEventListener('change', (e) => {
                currentPdf = e.target.value;
                currentPage = 1;
                populatePageSelect();
                renderComparison();
            });
        }
        
        function populatePageSelect() {
            const select = document.getElementById('page-select');
            select.innerHTML = '<option value="">-- Select Page --</option>';
            
            if (!currentPdf || !comparisonData.pdfs[currentPdf]) return;
            
            const pages = comparisonData.pdfs[currentPdf].pages;
            for (const pageNum in pages) {
                const option = document.createElement('option');
                option.value = pageNum;
                option.textContent = `Page ${pageNum}`;
                select.appendChild(option);
            }
            
            select.addEventListener('change', (e) => {
                currentPage = parseInt(e.target.value);
                renderComparison();
            });
            
            // Select first page
            if (Object.keys(pages).length > 0) {
                currentPage = parseInt(Object.keys(pages)[0]);
                select.value = currentPage;
            }
        }
        
        function prevPage() {
            if (!currentPdf || !comparisonData.pdfs[currentPdf]) return;
            const pages = Object.keys(comparisonData.pdfs[currentPdf].pages).map(Number).sort((a,b) => a-b);
            const idx = pages.indexOf(currentPage);
            if (idx > 0) {
                currentPage = pages[idx - 1];
                document.getElementById('page-select').value = currentPage;
                renderComparison();
            }
        }
        
        function nextPage() {
            if (!currentPdf || !comparisonData.pdfs[currentPdf]) return;
            const pages = Object.keys(comparisonData.pdfs[currentPdf].pages).map(Number).sort((a,b) => a-b);
            const idx = pages.indexOf(currentPage);
            if (idx < pages.length - 1) {
                currentPage = pages[idx + 1];
                document.getElementById('page-select').value = currentPage;
                renderComparison();
            }
        }
        
        function renderComparison() {
            if (!currentPdf || !currentPage) {
                return;
            }
            
            const pdfData = comparisonData.pdfs[currentPdf];
            const pageData = pdfData.pages[currentPage];
            
            if (!pageData) {
                document.getElementById('original-panel').innerHTML = '<div class="no-data">No data for this page</div>';
                document.getElementById('traditional-panel').innerHTML = '<div class="no-data">No data for this page</div>';
                document.getElementById('multimodal-panel').innerHTML = '<div class="no-data">No data for this page</div>';
                return;
            }
            
            // Render original page image
            if (pageData.image) {
                document.getElementById('original-panel').innerHTML = 
                    `<img class="page-image" src="data/${pageData.image}" alt="Page ${currentPage}">`;
            } else {
                document.getElementById('original-panel').innerHTML = '<div class="no-data">No image available</div>';
            }
            
            // Render traditional extraction
            renderTraditional(pageData.traditional);
            
            // Render multimodal extraction
            renderMultimodal(pageData.multimodal);
        }
        
        function renderTraditional(data) {
            if (!data) {
                document.getElementById('traditional-panel').innerHTML = '<div class="no-data">No traditional extraction data</div>';
                return;
            }
            
            let html = `
                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-value">${data.text_length || 0}</div>
                        <div class="stat-label">Characters</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">${data.image_count || 0}</div>
                        <div class="stat-label">Images Detected</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">${data.block_count || 0}</div>
                        <div class="stat-label">Text Blocks</div>
                    </div>
                </div>
                <div class="section">
                    <div class="section-title">Extracted Text</div>
                    <div class="extraction-text">${escapeHtml(data.text || 'No text extracted')}</div>
                </div>
            `;
            
            document.getElementById('traditional-panel').innerHTML = html;
        }
        
        function renderMultimodal(data) {
            if (!data) {
                document.getElementById('multimodal-panel').innerHTML = '<div class="no-data">No multimodal extraction data</div>';
                return;
            }
            
            if (data.error) {
                document.getElementById('multimodal-panel').innerHTML = 
                    `<div class="no-data">Error: ${escapeHtml(data.message || 'Unknown error')}</div>`;
                return;
            }
            
            let html = '';
            
            // Key concepts
            if (data.key_concepts && data.key_concepts.length > 0) {
                html += `
                    <div class="section">
                        <div class="section-title">Key Concepts</div>
                        <div class="key-concepts">
                            ${data.key_concepts.map(c => `<span class="concept-tag">${escapeHtml(c)}</span>`).join('')}
                        </div>
                    </div>
                `;
            }
            
            // Citations
            if (data.citations_mentioned && data.citations_mentioned.length > 0) {
                html += `
                    <div class="section">
                        <div class="section-title">Citations Mentioned</div>
                        <div class="key-concepts">
                            ${data.citations_mentioned.map(c => `<span class="citation-tag">${escapeHtml(c)}</span>`).join('')}
                        </div>
                    </div>
                `;
            }
            
            // Figures
            if (data.figures && data.figures.length > 0) {
                html += `
                    <div class="section">
                        <div class="section-title">Figures (${data.figures.length})</div>
                        ${data.figures.map(f => `
                            <div class="figure-item">
                                <div class="caption">Figure ${f.number}: ${escapeHtml(f.caption || '')}</div>
                                <div class="description">${escapeHtml(f.description || 'No description')}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            // Tables
            if (data.tables && data.tables.length > 0) {
                html += `
                    <div class="section">
                        <div class="section-title">Tables (${data.tables.length})</div>
                        ${data.tables.map(t => `
                            <div class="figure-item">
                                <div class="caption">Table ${t.number}: ${escapeHtml(t.caption || '')}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            // Text content
            if (data.text_content) {
                html += `
                    <div class="section">
                        <div class="section-title">Extracted Text</div>
                        <div class="extraction-text">${escapeHtml(data.text_content)}</div>
                    </div>
                `;
            }
            
            if (!html) {
                html = '<div class="no-data">No structured data extracted</div>';
            }
            
            document.getElementById('multimodal-panel').innerHTML = html;
        }
        
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Load data on page load
        loadData();
    </script>
</body>
</html>
